<div class="mwr-backdrop">
    <div class="mwr-particles">
        <span *ngFor="let p of particles" class="particle" [style.left]="p.x + '%'" [style.animationDelay]="p.delay + 's'" [style.animationDuration]="p.duration + 's'"></span>
    </div>

    <div class="mwr-container">
        <!-- Top Bar -->
        <header class="mwr-header">
            <div class="mwr-header-left">
                <button class="mwr-btn mwr-btn-cancel" (click)="cancelGame()">
                    <i class="material-icons">close</i>
                    <span>{{ 'BUTTONS.CANCEL' | translate }}</span>
                </button>
            </div>
            <div class="mwr-header-center">
                <div class="mwr-access-code-card">
                    <span class="mwr-code-label">{{ 'JOIN_MATCH.ACCESS_CODE' | translate }}</span>
                    <div class="mwr-code-value-row">
                        <span class="mwr-code-value">
                            <span *ngFor="let digit of accessCodeDigits; let i = index"
                                  class="mwr-digit"
                                  [style.animationDelay]="(i * 0.08) + 's'">{{ digit }}</span>
                        </span>
                        <button class="mwr-copy-btn" [cdkCopyToClipboard]="accessCode" (click)="copyCode()" [class.copied]="isCopied">
                            <i class="material-icons">{{ isCopied ? 'check_circle' : 'content_copy' }}</i>
                        </button>
                    </div>
                </div>
            </div>
            <div class="mwr-header-right">
                <button class="mwr-btn mwr-btn-lock" [class.locked]="waitingRoomIsLocked" (click)="onLockWaitingRoom()">
                    <i class="material-icons">{{ waitingRoomIsLocked ? 'lock' : 'lock_open' }}</i>
                    <span>{{ getTranslationLock() | translate }}</span>
                </button>
            </div>
        </header>

        <!-- Status Hints -->
        <div class="mwr-status-strip">
            <div class="mwr-status-hint" *ngIf="!matchSrv.match.players.length">
                <i class="material-icons pulse-icon">person_add</i>
                <span>{{ 'TITLES.INVITE_PLAYERS' | translate }}</span>
            </div>
            <div class="mwr-status-hint"
                 *ngIf="matchSrv.match.players.length && isMinPlayersConditionValid() && areAllTeamsValid() && !waitingRoomIsLocked">
                <i class="material-icons pulse-icon">lock_outline</i>
                <span>{{ 'TITLES.LOCK_MATCH' | translate }}</span>
            </div>
            <div class="mwr-status-hint warning" *ngIf="matchSrv.match.players.length && !isMinPlayersConditionValid()">
                <i class="material-icons">warning_amber</i>
                <span>{{ 'TITLES.MIN_TEAM_PLAYERS' | translate }}</span>
            </div>
            <div class="mwr-status-hint warning" *ngIf="isMinPlayersConditionValid() && !areAllTeamsValid()">
                <i class="material-icons">warning_amber</i>
                <span>{{ 'TITLES.VALID_TEAMS' | translate }}</span>
            </div>
        </div>

        <!-- Main Content -->
        <main class="mwr-main">
            <!-- Players Section (Solo) -->
            <section class="mwr-players-section" *ngIf="!matchSrv.match.isTeamMatch">
                <div class="mwr-section-header">
                    <i class="material-icons">groups</i>
                    <h2>{{ 'TITLES.PLAYERS_CONNECTED' | translate }}</h2>
                    <span class="mwr-player-count">{{ matchSrv.match.players.length }}</span>
                </div>
                <div class="mwr-players-grid" [class.empty]="!matchSrv.match.players.length">
                    <div *ngIf="!matchSrv.match.players.length" class="mwr-empty-state">
                        <div class="mwr-empty-icon-wrapper">
                            <i class="material-icons">hourglass_empty</i>
                        </div>
                        <p>{{ 'TITLES.INVITE_PLAYERS' | translate }}</p>
                    </div>
                    <app-player-card
                        *ngFor="let player of matchSrv.getPlayersNotInTeam(); let i = index"
                        [player]="player"
                        [isManager]="true"
                        [accessCode]="accessCode"
                        [style.animationDelay]="(i * 0.06) + 's'"
                        class="mwr-player-card-enter"
                    ></app-player-card>
                </div>
            </section>

            <!-- Team Mode -->
            <div class="mwr-team-layout" *ngIf="matchSrv.match.isTeamMatch">
                <section class="mwr-unassigned-section">
                    <div class="mwr-section-header">
                        <i class="material-icons">person_outline</i>
                        <h2>Unassigned</h2>
                        <span class="mwr-player-count">{{ matchSrv.getPlayersNotInTeam().length }}</span>
                    </div>
                    <div class="mwr-unassigned-players">
                        <app-player-card
                            *ngFor="let player of matchSrv.getPlayersNotInTeam(); let i = index"
                            [player]="player"
                            [isManager]="true"
                            [accessCode]="accessCode"
                            [style.animationDelay]="(i * 0.06) + 's'"
                            class="mwr-player-card-enter"
                        ></app-player-card>
                    </div>
                </section>
                <section class="mwr-teams-section">
                    <div class="mwr-section-header">
                        <i class="material-icons">groups</i>
                        <h2>Teams</h2>
                        <span class="mwr-player-count">{{ matchSrv.match.teams.length }}</span>
                    </div>
                    <div class="mwr-teams-grid">
                        <div *ngFor="let team of matchSrv.match.teams; let i = index"
                             class="mwr-team-card"
                             [style.animationDelay]="(i * 0.1) + 's'">
                            <div class="mwr-team-card-header">
                                <i class="material-icons">shield</i>
                                <h3>{{ team.name }}</h3>
                                <span class="mwr-team-member-count">{{ team.players.length }}/2</span>
                            </div>
                            <div class="mwr-team-players">
                                <app-player-card
                                    *ngFor="let player of team.players"
                                    [player]="{ name: player, isActive: true, score: 0, nBonusObtained: 0, chatBlocked: false, avatar: player }"
                                    [isManager]="true"
                                    [accessCode]="accessCode"
                                ></app-player-card>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </main>

        <!-- Start Button (Floating) -->
        <div class="mwr-start-zone">
            <button
                class="mwr-start-btn"
                (click)="onBeginMatch()"
                [disabled]="!matchSrv.match.players.length || !waitingRoomIsLocked || !isMinPlayersConditionValid() || !areAllTeamsValid()"
                [class.ready]="matchSrv.match.players.length && waitingRoomIsLocked && isMinPlayersConditionValid() && areAllTeamsValid()"
            >
                <span class="mwr-start-btn-bg"></span>
                <span class="mwr-start-btn-content">
                    <i class="material-icons">play_arrow</i>
                    <span>{{ 'NAV_BUTTONS.START_MATCH' | translate }}</span>
                </span>
            </button>
        </div>
    </div>
</div>

<app-logo></app-logo>
